<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ - Ù†Ø¸Ø§Ù… Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø¹Ù† Ø§Ù„Ø·Ø§Ù„Ø¨</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap');
:root{
  --blue:#007bff;
  --green:#28a745;
  --danger:#dc3545;
  --bg1:#e0f0ff;
  --card-bg:#ffffff;
}
*{box-sizing:border-box}
body{
  font-family:'Cairo',sans-serif;
  direction:rtl;
  margin:0;
  min-height:100vh;
  background: linear-gradient(180deg,var(--bg1),#ffffff);
  display:flex;
  align-items:center;
  justify-content:center;
  padding:20px;
}
.container{
  width:100%;
  max-width:920px;
  background:var(--card-bg);
  border-radius:14px;
  box-shadow:0 10px 30px rgba(0,0,0,0.12);
  overflow:hidden;
  display:grid;
  grid-template-columns: 1fr 420px;
  gap:0;
}

/* left: info / logo */
.left{
  padding:30px;
  background: linear-gradient(180deg,var(--blue), #0a73d9);
  color:#fff;
  display:flex;
  flex-direction:column;
  justify-content:center;
  gap:12px;
}
.left h1{margin:0;font-size:26px}
.left p{margin:0;opacity:.95}

/* right: form */
.right{
  padding:28px;
  background:var(--card-bg);
}
.header{
  text-align:center;
  margin-bottom:12px;
}
.header h2{margin:0;font-size:20px}
.form{
  display:flex;
  flex-direction:column;
  gap:12px;
  margin-top:10px;
}
.input{
  display:flex;
  gap:8px;
  align-items:center;
  border:1px solid #e6e6e6;
  padding:10px;
  border-radius:8px;
  background:#fbfbfb;
}
.input input{
  border:0;
  outline:0;
  font-size:15px;
  flex:1;
  background:transparent;
  direction:rtl;
}
.btn{
  display:inline-block;
  padding:11px 18px;
  border-radius:8px;
  border:0;
  cursor:pointer;
  font-weight:700;
}
.btn-primary{background:var(--green); color:#fff}
.btn-link{
  background:transparent;
  color:var(--blue);
  font-weight:700;
  border:0;
}

/* small helper under form */
.actions{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-top:6px;
}
.note{font-size:13px;color:#666}

/* toast + messages */
.toast{
  position:fixed;
  left:50%;
  transform:translateX(-50%);
  bottom:28px;
  background:#222;
  color:#fff;
  padding:12px 18px;
  border-radius:10px;
  box-shadow:0 8px 24px rgba(0,0,0,0.2);
  opacity:0;
  pointer-events:none;
}
.toast.show{opacity:1;pointer-events:auto; animation:toastIn .35s ease-out}
@keyframes toastIn{from{transform:translateX(-50%) translateY(10px) scale(.98);opacity:0}to{transform:translateX(-50%) translateY(0) scale(1);opacity:1}}

/* error shake */
.shake{
  animation:shake .5s;
}
@keyframes shake{
  0%{transform:translateX(0)}
  20%{transform:translateX(-6px)}
  40%{transform:translateX(6px)}
  60%{transform:translateX(-4px)}
  80%{transform:translateX(4px)}
  100%{transform:translateX(0)}
}

/* responsive */
@media (max-width:880px){
  .container{grid-template-columns:1fr; padding:0}
  .left{display:none}
}
.footer{
  text-align:center;
  margin-top:14px;
  font-size:13px;
  color:#666;
}

/* small link style */
.small-link{font-size:14px;color:var(--blue);text-decoration:underline;cursor:pointer;background:none;border:0;padding:0}
</style>
</head>
<body>

<div class="container" role="main">
  <div class="left" aria-hidden="true">
    <h1>ðŸŽ“ Ø«Ø§Ù†ÙˆÙŠØ© Ø§Ù„ØªØ­Ø¯ÙŠ Ø§Ù„Ø£Ù‡Ù„ÙŠØ©</h1>
    <p>Ù†Ø¸Ø§Ù… Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø£ÙˆÙ„ÙŠØ§Ø¡ Ø§Ù„Ø£Ù…ÙˆØ± Ø¹Ù† Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨ ÙˆØ§Ù„Ø¯Ø±Ø¬Ø§Øª ÙˆØ§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©.</p>
    <p style="opacity:.9">Ø§Ù„Ø¹Ø§Ù… Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ 2025-2026 â€” Ù‚Ø³Ù… Ø§Ù„Ø­ÙˆÙƒÙ…Ø©</p>
  </div>

  <div class="right">
    <div class="header">
      <h2>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
      <div class="note">Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø± ÙˆÙƒÙˆØ¯ Ø§Ù„Ø·Ø§Ù„Ø¨ Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©</div>
    </div>

    <div class="form" id="loginForm">
      <div class="input">
        <input id="parentInput" inputmode="numeric" placeholder="Ø±Ù‚Ù… ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±" aria-label="Ø±Ù‚Ù… ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±" />
      </div>

      <div class="input" id="codeWrapper">
        <input id="codeInput" placeholder="ÙƒÙˆØ¯ Ø§Ù„Ø·Ø§Ù„Ø¨" aria-label="ÙƒÙˆØ¯ Ø§Ù„Ø·Ø§Ù„Ø¨" />
      </div>

      <div style="display:flex;gap:8px;align-items:center">
        <button class="btn btn-primary" id="loginBtn">Ø¯Ø®ÙˆÙ„</button>
        <button class="btn" id="clearBtn" style="background:#f0f0f0">Ù…Ø³Ø­</button>
      </div>

      <div class="actions">
        <div><button class="small-link" id="goForgot">Ù†Ø³ÙŠØª Ø§Ù„ÙƒÙˆØ¯ØŸ</button></div>
        <div class="note">Ø£Ùˆ ØªÙˆØ¬Ù‡ Ø¥Ù„Ù‰ <a href="dashboard.html">Ø¹Ø±Ø¶ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… (ØªØ¬Ø±ÙŠØ¨ÙŠ)</a></div>
      </div>

      <div class="footer">
        <small>Ø§Ù„Ø¥ØµØ¯Ø§Ø± V0.1.2 â€” Ø­Ù‚ÙˆÙ‚ Â© Ø«Ø§Ù†ÙˆÙŠØ© Ø§Ù„ØªØ­Ø¯ÙŠ Ø§Ù„Ø£Ù‡Ù„ÙŠØ©</small>
      </div>
    </div>
  </div>
</div>

<div id="toast" class="toast" role="status" aria-live="polite"></div>

<script>
/* ========== Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ================= */
const sheetURL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vReghaYoMk3f8ffSBLRHIwZieEWCfk5Yx8W6c843TXkC6wpA78Z0X5nw21RRpxMdQ/pub?gid=1229272896&single=true&output=csv";

/* CSV parser Ø¨Ø³ÙŠØ· Ù„ÙƒÙ† Robust Ù„Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ù‚ØªØ¨Ø³Ø© */
function parseCSV(text){
  const rows = [];
  let cur = '', row = [], inQuotes=false;
  for(let i=0;i<text.length;i++){
    const ch = text[i];
    const next = text[i+1];
    if(ch === '"'){
      if(inQuotes && next === '"'){ cur += '"'; i++; continue; } // escaped quote
      inQuotes = !inQuotes;
      continue;
    }
    if(ch === '\r') continue;
    if(ch === ',' && !inQuotes){
      row.push(cur);
      cur = '';
      continue;
    }
    if(ch === '\n' && !inQuotes){
      row.push(cur);
      rows.push(row);
      row = [];
      cur = '';
      continue;
    }
    cur += ch;
  }
  // leftover
  if(cur !== '' || row.length > 0){
    row.push(cur);
    rows.push(row);
  }
  return rows;
}

function normalizeKey(k){ return (k||'').toString().trim(); }

/* fetch sheet and build array of objects */
async function fetchSheetObjects(){
  const resp = await fetch(sheetURL);
  if(!resp.ok) throw new Error("ÙØ´Ù„ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
  const text = await resp.text();
  const rows = parseCSV(text).filter(r=>r.some(c=>c.trim() !== ''));
  if(rows.length === 0) return {header:[], rows:[]};
  const header = rows[0].map(h=>normalizeKey(h));
  const dataRows = rows.slice(1);
  const objects = dataRows.map(r=>{
    const obj={};
    for(let i=0;i<header.length;i++){
      obj[header[i]] = (r[i]||'').toString().trim();
    }
    return obj;
  });
  return {header, rows:objects};
}

/* Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© */
const toastEl = document.getElementById('toast');
function showToast(msg, timeout=2200){
  toastEl.textContent = msg;
  toastEl.classList.add('show');
  setTimeout(()=>toastEl.classList.remove('show'), timeout);
}

/* helpers */
function cleanNumber(n){ if(!n) return ''; n = n.toString().trim(); if(n.startsWith('0')) n = n.replace(/^0+/, ''); return n; }

document.getElementById('goForgot').addEventListener('click', ()=> {
  // Ø±Ø§Ø¨Ø· Ù„ØµÙØ­Ø© forgot
  window.location.href = 'forgot.html';
});

document.getElementById('clearBtn').addEventListener('click', ()=>{
  document.getElementById('parentInput').value = '';
  document.getElementById('codeInput').value = '';
  showToast('ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ø­Ù‚ÙˆÙ„');
});

/* Ø¹Ù…Ù„ÙŠØ© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ */
document.getElementById('loginBtn').addEventListener('click', async ()=>{
  const parentRaw = document.getElementById('parentInput').value;
  const codeRaw = document.getElementById('codeInput').value;
  const parent = cleanNumber(parentRaw);
  const code = (codeRaw||'').toString().trim().replace(/^0+/,'');
  if(!parent || !code){
    // Ù‡Ø² Ø§Ù„Ø­Ù‚Ù„
    const wrapper = document.getElementById('codeWrapper');
    wrapper.classList.add('shake');
    setTimeout(()=>wrapper.classList.remove('shake'),500);
    showToast('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø± ÙˆÙƒÙˆØ¯ Ø§Ù„Ø·Ø§Ù„Ø¨',2000);
    return;
  }

  try{
    showToast('â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...');
    const {header, rows} = await fetchSheetObjects();
    // Ù†Ø­Ø§ÙˆÙ„ Ø¥ÙŠØ¬Ø§Ø¯ Ø³Ø¬Ù„ ÙŠØ·Ø§Ø¨Ù‚ Ø§Ù„ÙƒÙˆØ¯ ÙˆØ±Ù‚Ù… ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±
    const found = rows.find(r=>{
      const p = cleanNumber(r['Ø±Ù‚Ù… ÙˆÙ„ÙŠ Ø§Ù„Ø§Ù…Ø±'] || r['Ø±Ù‚Ù… ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±'] || r['ÙˆÙ„ÙŠ Ø§Ù„Ø§Ù…Ø±'] || r['parent'] || r['Parent']);
      const c = (r['ÙƒÙˆØ¯ Ø§Ù„Ø·Ø§Ù„Ø¨']||r['ÙƒÙˆØ¯']||r['id']||'').toString().trim().replace(/^0+/,'');
      return p === parent && c === code;
    });

    if(!found){
      showToast('âŒ Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± Ù…Ø·Ø§Ø¨Ù‚Ø© â€” ØªØ­Ù‚Ù‚ Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ù… "Ù†Ø³ÙŠØª Ø§Ù„ÙƒÙˆØ¯ØŸ"', 3000);
      return;
    }

    // ØªØ³Ø¬ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬Ù„Ø³Ø© ÙÙŠ sessionStorage
    sessionStorage.setItem('studentData', JSON.stringify(found));
    showToast('âœ” ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ â€” Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­ÙˆÙŠÙ„...', 900);
    setTimeout(()=> window.location.href = 'dashboard.html', 800);

  }catch(err){
    console.error(err);
    showToast('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù…Ù„Ù. ØªØ£ÙƒØ¯ Ù…Ù† Ø§ØªØµØ§Ù„ Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª.', 3200);
  }
});

/* Enter ÙŠØ¯Ø¹Ù… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ */
document.getElementById('loginForm').addEventListener('keydown', (e)=>{
  if(e.key === 'Enter') { e.preventDefault(); document.getElementById('loginBtn').click(); }
});
</script>
</body>
</html>
