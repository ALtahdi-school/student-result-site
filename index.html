<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ุชุณุฌูู ุงูุฏุฎูู</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<header>๐ ุซุงูููุฉ ุงูุชุญุฏู ุงูุฃูููุฉ</header>

<div class="login-box">
  <h2>ุชุณุฌูู ุงูุฏุฎูู</h2>
  <input type="text" id="parentNumber" placeholder="ุฑูู ููู ุงูุฃูุฑ">
  <input type="text" id="studentCode" placeholder="ููุฏ ุงูุทุงูุจ">
  <button onclick="login()">ุชุณุฌูู ุงูุฏุฎูู</button>
  <p id="status" style="text-align:center; margin-top:10px;"></p>
</div>

<script>
async function login(){
  const code = document.getElementById("studentCode").value.trim();
  const parent = document.getElementById("parentNumber").value.trim();
  const status = document.getElementById("status");
  if(!code || !parent){
    status.textContent = "โ๏ธ ูุฑุฌู ุฅุฏุฎุงู ููุฏ ุงูุทุงูุจ ูุฑูู ููู ุงูุฃูุฑ";
    return;
  }

  status.textContent = "โณ ุฌุงุฑู ุงูุชุญูู ูู ุงูุจูุงูุงุช...";

  const sheetURL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vReghaYoMk3f8ffSBLRHIwZieEWCfk5Yx8W6c843TXkC6wpA78Z0X5nw21RRpxMdQ/pub?gid=1229272896&single=true&output=csv";
  
  try {
    const resp = await fetch(sheetURL);
    const text = await resp.text();
    const rows = text.split("\n").map(r=>r.split(","));
    const header = rows[0].map(h=>h.trim());
    const dataRows = rows.slice(1);
    const objects = dataRows.map(r=>{
      const obj={};
      for(let i=0;i<header.length;i++) obj[header[i]]=(r[i]||"").trim();
      return obj;
    });

    const student = objects.find(o=>o["ููุฏ ุงูุทุงูุจ"]===code && o["ุฑูู ููู ุงูุงูุฑ"]===parent);
    if(!student){
      status.textContent = "โ ูู ูุชู ุงูุนุซูุฑ ุนูู ุงูุทุงูุจ. ุชุญูู ูู ุงูุจูุงูุงุช.";
      return;
    }

    // ุญูุธ ุงูุจูุงูุงุช ูู localStorage
    localStorage.setItem("loggedIn", "true");
    localStorage.setItem("studentCode", code);
    localStorage.setItem("parentNumber", parent);
    localStorage.setItem("studentClass", student["ุงูุตู"]);
    localStorage.setItem("studentName", student["ุงุณู ุงูุทุงูุจ"]);
    localStorage.setItem("studentData", JSON.stringify(student));

    status.textContent = "โ ุชู ุชุณุฌูู ุงูุฏุฎูู ุจูุฌุงุญ!";
    setTimeout(()=> window.location.href="dashboard.html", 800);

  } catch(err){
    console.error(err);
    status.textContent = "โ๏ธ ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุงูุงุชุตุงู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช.";
  }
}
</script>

</body>
</html>
