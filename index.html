<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù†Ø¸Ø§Ù… Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø¹Ù† Ø§Ù„Ø·Ø§Ù„Ø¨ - Ø«Ø§Ù†ÙˆÙŠØ© Ø§Ù„ØªØ­Ø¯ÙŠ</title>
<link rel="stylesheet" href="style.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
<script src="main.js" defer></script>
</head>
<body>

<header>
  ğŸ“ Ø«Ø§Ù†ÙˆÙŠØ© Ø§Ù„ØªØ­Ø¯ÙŠ Ø§Ù„Ø£Ù‡Ù„ÙŠØ©
  <span>Ø§Ù„Ø¹Ø§Ù… Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ 2025-2026</span>
</header>

<div class="input-group">
  <input id="parentNumber" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±">
  <input id="studentCode" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„Ø·Ø§Ù„Ø¨">
  <button onclick="searchStudent()">Ø¨Ø­Ø«</button>
  <button id="forgotBtn">Ù†Ø³ÙŠØª Ø§Ù„ÙƒÙˆØ¯ØŸ</button>
</div>

<div class="year-label">Ø§Ù„Ø¹Ø§Ù… Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ 2025-2026</div>
<div class="container" id="output"></div>
<div class="version">Ø§Ù„Ø¥ØµØ¯Ø§Ø± V0.2.4</div>
<div class="governance">
  Ù‚Ø³Ù… Ø§Ù„Ø­ÙˆÙƒÙ…Ø©: Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© Â© Ø«Ø§Ù†ÙˆÙŠØ© Ø§Ù„ØªØ­Ø¯ÙŠ Ø§Ù„Ø£Ù‡Ù„ÙŠØ©
</div>

<script>
document.getElementById('forgotBtn').addEventListener('click', ()=> window.location.href='forgot.html');

async function searchStudent(){
  const codeEl = document.getElementById('studentCode');
  const parentEl = document.getElementById('parentNumber');
  let code = codeEl.value.trim();
  let parent = parentEl.value.trim();
  if(parent.startsWith('0')) parent = parent.substring(1);
  if(code.startsWith('0')) code = code.substring(1);

  const output = document.getElementById('output');
  if(!code || !parent){ output.innerHTML="<p style='color:#dc3545;text-align:center;'>âš ï¸ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„</p>"; return; }

  output.innerHTML="<p style='text-align:center;'>â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø«...</p>";

  try{
    const student = await window.StudentPortal.findByParentAndCode(parent, code);
    if(!student){ output.innerHTML="<p style='color:#dc3545;text-align:center;'>âŒ Ù„Ù… Ø£Ø¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø·Ø§Ø¨Ù‚Ø©</p>"; return; }

    window.StudentPortal.saveSession(student);

    let html="";
    // Ù…Ø«Ø§Ù„ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¹Ø§Ù…Ø©
    html+=`<div class="section info"><h3>Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©</h3><table>`;
    const infoFields=["id","Ø±Ù‚Ù… Ø§Ù„Ø·Ø§Ù„Ø¨","Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨","Ø§Ù„Ø¬Ù†Ø³","Ø§Ù„ØµÙ","Ø§Ù„Ù‚Ø§Ø¹Ø©","Ø±Ù‚Ù… ÙˆÙ„ÙŠ Ø§Ù„Ø§Ù…Ø±","Ø±Ù‚Ù… Ø§Ù„Ø®Ø·"];
    infoFields.forEach(f=>{ if(student[f]) html+=`<tr><th>${f}</th><td>${student[f]}</td></tr>`; });
    html+="</table></div>";

    // Ù…Ø«Ø§Ù„ Ù…Ù„Ø§Ø­Ø¸Ø§Øª
    html+=`<div class="section notes"><h3>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</h3><table>`;
    const noteFields=["Ù…Ù„Ø§Ø­Ø¸Ø§Øª ÙƒØ±Øª","Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù†ØªÙŠØ¬Ø©","Ø§Ù„ØºÙŠØ§Ø¨"];
    noteFields.forEach(f=>{ if(student[f]) html+=`<tr><th>${f}</th><td>${student[f]}</td></tr>`; });
    html+="</table></div>";

    output.innerHTML = html;

  }catch(err){
    console.error(err);
    output.innerHTML="<p style='color:#dc3545;text-align:center;'>âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</p>";
  }
}

// Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù†Ø¯ ÙˆØ¬ÙˆØ¯ Ø¬Ù„Ø³Ø© Ù…Ø­ÙÙˆØ¸Ø©
document.addEventListener('DOMContentLoaded', ()=>{
  const s = window.StudentPortal.getSession();
  if(s){
    document.getElementById('studentCode').value = s['ÙƒÙˆØ¯ Ø§Ù„Ø·Ø§Ù„Ø¨']||s['id']||'';
    document.getElementById('parentNumber').value = s['Ø±Ù‚Ù… ÙˆÙ„ÙŠ Ø§Ù„Ø§Ù…Ø±']||s['Ø±Ù‚Ù… ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±']||'';
    searchStudent();
  }
});
</script>

</body>
</html>
