<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù†Ø¸Ø§Ù… Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø¹Ù† Ø§Ù„Ø·Ø§Ù„Ø¨</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
<style>
body{
  font-family:'Cairo',sans-serif;
  direction:rtl;
  margin:0;
  padding:0;
  background:linear-gradient(to bottom,#e0f0ff,#ffffff);
  overflow-x:hidden;
}
header{
  background:#4e54c8;
  color:#fff;
  text-align:center;
  padding:25px 10px;
  font-size:24px;
  font-weight:bold;
}
header span{
  display:block;
  font-size:16px;
  font-weight:normal;
  margin-top:5px;
  opacity:0.8;
}
.container{
  max-width:1200px;
  margin:0 auto;
  padding:15px;
}
.input-group{
  display:flex;
  justify-content:center;
  flex-wrap:wrap;
  gap:10px;
  margin:20px 0;
}
.input-group input{
  flex:0 0 160px;
  padding:10px;
  font-size:14px;
  border-radius:8px;
  border:1px solid #ccc;
}
.input-group input:focus{
  outline:none;
  border-color:#4e54c8;
  box-shadow:0 0 8px rgba(78,84,200,0.3);
}
button{
  padding:10px 25px;
  font-size:14px;
  border:none;
  border-radius:8px;
  cursor:pointer;
  font-weight:700;
  transition:all 0.3s ease;
}
button:hover{
  transform:scale(1.05);
}
#loginBtn{
  background:linear-gradient(90deg,#4e54c8,#8f94fb);
  color:#fff;
}
#logoutBtn{
  background:#ff4e50;
  color:#fff;
}
#forgotBtn{
  background:#ffc107;
  color:#000;
}
.section{
  background:#fff;
  border-radius:12px;
  padding:15px;
  margin-bottom:20px;
  box-shadow:0 10px 30px rgba(0,0,0,0.1);
  display:none;
}
.section h3{
  text-align:center;
  margin-bottom:10px;
}
table{
  width:100%;
  border-collapse:collapse;
}
th,td{
  padding:6px 4px;
  border:1px solid #ddd;
  word-wrap:break-word;
  text-align:right;
}
tr:hover{
  background-color:rgba(78,84,200,0.1);
}

/* Ø§Ù„Ø¨Ø§Ø± Ø§Ù„Ø³ÙÙ„ÙŠ */
.bottom-bar{
  display: none; /* Ù…Ø®ÙÙŠ Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹ */
  position: fixed;
  bottom: 0;
  left: 0;
  width: 100%;
  display: flex;
  justify-content: space-around;
  background: linear-gradient(90deg,#4e54c8,#8f94fb);
  padding: 10px 0;
  border-top-left-radius: 20px;
  border-top-right-radius: 20px;
  box-shadow: 0 -4px 12px rgba(0,0,0,0.15);
  z-index: 1000;
}
.bottom-bar button{
  flex:1;
  margin:0 5px;
  padding:10px 0;
  border:none;
  border-radius:15px;
  background:rgba(255,255,255,0.2);
  color:#fff;
  font-weight:700;
  cursor:pointer;
  position:relative;
  overflow:hidden;
}
.bottom-bar button.active,
.bottom-bar button:hover{
  background:rgba(255,255,255,0.35);
  transform:translateY(-3px);
  box-shadow:0 4px 12px rgba(0,0,0,0.2);
}
.bottom-bar button::after{
  content:'';
  position:absolute;
  width:100%;
  height:3px;
  bottom:0;
  left:0;
  background:#ff7e5f;
  transform:scaleX(0);
  transform-origin:right;
  transition:transform 0.3s ease;
}
.bottom-bar button.active::after,
.bottom-bar button:hover::after{
  transform:scaleX(1);
  transform-origin:left;
}
</style>
</head>
<body>

<header>
ğŸ“ Ø«Ø§Ù†ÙˆÙŠØ© Ø§Ù„ØªØ­Ø¯ÙŠ Ø§Ù„Ø£Ù‡Ù„ÙŠØ©
<span>Ø§Ù„Ø¹Ø§Ù… Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ 2025-2026</span>
</header>

<div class="input-group" id="loginForm">
  <input id="parentNumber" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±">
  <input id="studentCode" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„Ø·Ø§Ù„Ø¨">
  <button id="loginBtn">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
  <button id="forgotBtn" onclick="window.location.href='forgot.html'">Ù†Ø³ÙŠØª Ø§Ù„ÙƒÙˆØ¯ØŸ</button>
</div>

<div class="container">
  <!-- Ø§Ù„Ø­Ø³Ø§Ø¨ -->
  <div class="section" id="accountSection">
    <button id="logoutBtn">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
    <h3>Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©</h3>
    <table id="generalInfoTable"></table>
    <h3>Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©</h3>
    <table id="financialTable"></table>
  </div>

  <!-- Ø§Ù„Ø¯Ø±Ø¬Ø§Øª -->
  <div class="section" id="gradesSection">
    <h3>Ø§Ù„Ø¯Ø±Ø¬Ø§Øª Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ©</h3>
    <table id="gradesTable"></table>
    <h3>Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª ÙˆØ§Ù„ØºÙŠØ§Ø¨</h3>
    <table id="notesTable"></table>
  </div>

  <!-- Ø§Ù„ØªØ¨Ù„ÙŠØºØ§Øª -->
  <div class="section" id="notificationsSection">
    <h3>Ø§Ù„ØªØ¨Ù„ÙŠØºØ§Øª</h3>
    <div id="notificationsArea">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ¨Ù„ÙŠØºØ§Øª Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†.</div>
  </div>

  <!-- Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© -->
  <div class="section" id="chatSection">
    <h3>Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ù…Ø¹ Ø·Ù„Ø§Ø¨ ØµÙÙƒ</h3>
    <div id="chatArea">ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„ØµÙŠØ§Ù†Ø©ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ù„Ø­ÙŠÙ† Ø§ÙƒØªÙ…Ø§Ù„Ù‡Ø§.</div>
  </div>
</div>

<!-- Ø§Ù„Ø¨Ø§Ø± Ø§Ù„Ø³ÙÙ„ÙŠ -->
<div class="bottom-bar">
  <button class="active" data-target="accountSection">Ø§Ù„Ø­Ø³Ø§Ø¨</button>
  <button data-target="gradesSection">Ø§Ù„Ø¯Ø±Ø¬Ø§Øª</button>
  <button data-target="notificationsSection">Ø§Ù„ØªØ¨Ù„ÙŠØºØ§Øª</button>
  <button data-target="chatSection">Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©</button>
</div>

<script src="data.js"></script>
<script>
// GSAP Animation
window.addEventListener('DOMContentLoaded', ()=>{
  gsap.from('.input-group input, #loginBtn, #forgotBtn',{duration:0.8,opacity:0,y:30,stagger:0.1});
  gsap.from('.bottom-bar',{duration:0.8,opacity:0,y:80,ease:"power3.out"});
});

// ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙˆØ§Ù„Ø®Ø±ÙˆØ¬
const loginBtn=document.getElementById('loginBtn');
const logoutBtn=document.getElementById('logoutBtn');
const loginForm=document.getElementById('loginForm');
const accountSection=document.getElementById('accountSection');
const sections=[accountSection,document.getElementById('gradesSection'),document.getElementById('notificationsSection'),document.getElementById('chatSection')];

loginBtn.addEventListener('click', async ()=>{
  const parent=document.getElementById('parentNumber').value.trim();
  const code=document.getElementById('studentCode').value.trim();
  if(!parent||!code){alert("Ø§Ø¯Ø®Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª"); return;}
  const student=await fetchStudentData(parent,code);
  if(!student){alert("Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª"); return;}
  
  loginForm.style.display='none';
  sections.forEach(s=>s.style.display='none');
  accountSection.style.display='block';
  
  // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø¨Ø§Ø± Ø§Ù„Ø³ÙÙ„ÙŠ Ø¨Ø¹Ø¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
  document.querySelector('.bottom-bar').style.display = 'flex';

  populateAccount(student);
  populateGrades(student);
  populateNotifications(student);
});

// ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
logoutBtn.addEventListener('click', ()=>{
  loginForm.style.display='flex';
  sections.forEach(s=>s.style.display='none');
  document.querySelector('.bottom-bar').style.display = 'none';
});

// ØªÙ†Ù‚Ù„ Ø¨ÙŠÙ† Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
document.querySelectorAll('.bottom-bar button').forEach(btn=>{
  btn.addEventListener('click', ()=>{
    document.querySelectorAll('.bottom-bar button').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    const target=btn.getAttribute('data-target');
    sections.forEach(s=>s.style.display=(s.id===target)?'block':'none');
  });
});

// Ø¯ÙˆØ§Ù„ Ù„ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø­Ø³Ø§Ø¨ ÙˆØ§Ù„Ø¯Ø±Ø¬Ø§Øª ÙˆØ§Ù„ØªØ¨Ù„ÙŠØºØ§Øª
function populateAccount(student){
  const genTable=document.getElementById('generalInfoTable');
  genTable.innerHTML='';
  const generalFields=["id","Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨","Ø§Ù„ØµÙ","Ø§Ù„Ù‚Ø§Ø¹Ø©","Ø§Ù„Ø¬Ù†Ø³","Ø±Ù‚Ù… ÙˆÙ„ÙŠ Ø§Ù„Ø§Ù…Ø±","Ø±Ù‚Ù… Ø§Ù„Ø®Ø·","Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª","ÙƒÙˆØ¯ Ø§Ù„Ø·Ø§Ù„Ø¨","Ø±Ù‚Ù… Ø§Ù„Ø·Ø§Ù„Ø¨","Ù…Ù„Ø§Ø­Ø¸Ø§Øª ÙƒØ±Øª","Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù†ØªÙŠØ¬Ø©","Ø§Ù„ÙƒØªØ¨","Ø§Ù„Ø¹Ù†ÙˆØ§Ù†","Ø§Ø³Ù… Ø§Ù„Ø§Ù…","Ø§Ù„Ù…Ø¯Ø±Ø³Ø© Ø§Ù„Ù‚Ø§Ø¯Ù… Ù…Ù†Ù‡Ø§","Ø§Ù„Ù…Ø¹Ø¯Ù„ ÙÙŠ Ø§Ù„ØµÙ Ø§Ù„Ø³Ø§Ø¨Ù‚"];
  generalFields.forEach(f=>{
    if(student[f]!==undefined){
      const tr=document.createElement('tr');
      tr.innerHTML=`<th>${f}</th><td>${student[f]}</td>`;
      genTable.appendChild(tr);
    }
  });
  const finTable=document.getElementById('financialTable');
  finTable.innerHTML='';
  const financeFields=["Ø§Ù„Ù‚Ø³Ø· 1","ØªØ§Ø±ÙŠØ® 1","Ø§Ù„Ù‚Ø³Ø· 2","ØªØ§Ø±ÙŠØ® 2","Ø§Ù„Ù‚Ø³Ø· 3","ØªØ§Ø±ÙŠØ® 3","Ø§Ù„Ù‚Ø³Ø· 4","ØªØ§Ø±ÙŠØ® 4","Ø§Ù„Ù‚Ø³Ø· 5","ØªØ§Ø±ÙŠØ® 5","Ø§Ù„Ù‚Ø³Ø· 6","ØªØ§Ø±ÙŠØ® 6","Ø§Ù„Ù‚Ø³Ø· 7","ØªØ§Ø±ÙŠØ® 7","Ø§Ù„Ù‚Ø³Ø· 8","ØªØ§Ø±ÙŠØ® 8","Ø§Ù„Ø¨Ø§Ù‚ÙŠ Ø§Ù„ÙƒÙ„ÙŠ","Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„ÙƒÙ„ÙŠ","Ø§Ù„ÙˆØ§ØµÙ„ Ø§Ù„ÙƒÙ„ÙŠ","Ø§Ù„ÙƒÙØ§Ù„Ø©","Ù…Ø¨Ù„Øº Ø§Ù„ÙƒÙØ§Ù„Ø©"];
  financeFields.forEach(f=>{
    if(student[f]!==undefined){
      const tr=document.createElement('tr');
      tr.innerHTML=`<th>${f}</th><td>${student[f]}</td>`;
      finTable.appendChild(tr);
    }
  });
}

function populateGrades(student){
  const gradesTable=document.getElementById('gradesTable');
  gradesTable.innerHTML='';
  const subjects=["Ø§Ù„Ø§Ø³Ù„Ø§Ù…ÙŠØ©","Ø§Ù„Ø¹Ø±Ø¨ÙŠ","Ø§Ù„Ø§Ù†ÙƒÙ„ÙŠØ²ÙŠ","Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª","Ø§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¡","Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¡","Ø§Ù„Ø§Ø­ÙŠØ§Ø¡","Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ§Øª","Ø§Ù„Ø­Ø§Ø³ÙˆØ¨","Ø±ÙŠØ§Ø¶Ø©","ÙÙ†ÙŠØ©","Ø§Ù„Ø³Ù„ÙˆÙƒ"];
  subjects.forEach(sub=>{
    const cols=Object.keys(student).filter(k=>k.includes(sub));
    if(cols.length){
      const trHead=document.createElement('tr');
      cols.forEach(c=>trHead.innerHTML+=`<th>${c}</th>`);
      gradesTable.appendChild(trHead);
      const trData=document.createElement('tr');
      cols.forEach(c=>trData.innerHTML+=`<td>${student[c]}</td>`);
      gradesTable.appendChild(trData);
    }
  });
  const notesTable=document.getElementById('notesTable');
  notesTable.innerHTML='';
  ["Ù…Ù„Ø§Ø­Ø¸Ø§Øª ÙƒØ±Øª","Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù†ØªÙŠØ¬Ø©","Ø§Ù„ØºÙŠØ§Ø¨","Ø§Ø®ØªÙ„Ø§Ù‚ Ù…Ø´Ø§ÙƒÙ„ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ø¯Ø±Ø³Ø©"].forEach(f=>{
    if(student[f]!==undefined){
      const tr=document.createElement('tr');
      tr.innerHTML=`<th>${f}</th><td>${student[f]}</td>`;
      notesTable.appendChild(tr);
    }
  });
}

function populateNotifications(student){
  const notif=document.getElementById('notificationsArea');
  if(student["Ø§Ù„ØµÙ"]==="Ø§Ù„Ø§Ø¯Ø§Ø±Ø©"){
    notif.innerHTML=`<textarea id="notifInput" placeholder="Ø§ÙƒØªØ¨ ØªØ¨Ù„ÙŠØºÙƒ Ù‡Ù†Ø§" style="width:100%;height:60px;margin-bottom:8px;"></textarea>
    <button id="postNotif">Ù†Ø´Ø± Ø§Ù„ØªØ¨Ù„ÙŠØº</button>
    <div id="allNotifs"></div>`;
    document.getElementById('postNotif').addEventListener('click', ()=>{
      const val=document.getElementById('notifInput').value.trim();
      if(val==='') return;
      allNotifications.push(val);
      document.getElementById('notifInput').value='';
      renderAllNotifs();
    });
  } else {
    renderAllNotifs();
  }
}
function renderAllNotifs(){
  const container=document.getElementById('allNotifs')||document.getElementById('notificationsArea');
  container.innerHTML='';
  allNotifications.forEach(n=>{
    const div=document.createElement('div');
    div.style.padding='8px';
    div.style.background='rgba(78,84,200,0.1)';
    div.style.margin='4px 0';
    div.style.borderRadius='8px';
    div.textContent=n;
    container.appendChild(div);
  });
}

// Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª ÙˆÙ‡Ù…ÙŠØ© Ù…Ø¤Ù‚ØªØ§Ù‹ Ø­ØªÙ‰ ÙŠØªÙ… Ø±Ø¨Ø· Google Sheets
let allNotifications=[];

async function fetchStudentData(parent,code){
  if(typeof STUDENTS_DATA==='undefined') return null;
  return STUDENTS_DATA.find(s=>{
    return (s["Ø±Ù‚Ù… ÙˆÙ„ÙŠ Ø§Ù„Ø§Ù…Ø±"]==parent||s["parent"]==parent) && (s["ÙƒÙˆØ¯ Ø§Ù„Ø·Ø§Ù„Ø¨"]==code||s["id"]==code);
  });
}
</script>

</body>
</html>
