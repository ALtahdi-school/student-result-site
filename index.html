<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ูุธุงู ุงูุทูุงุจ - ุซุงูููุฉ ุงูุชุญุฏู</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
<style>
:root{
  --primary-blue:#4e54c8;
  --secondary-purple:#8f94fb;
  --accent-orange:#ff7e5f;
  --accent-red:#ff4e50;
  --bg-gradient: linear-gradient(135deg,var(--primary-blue),var(--secondary-purple));
  --card-bg:#fff;
  --text-main:#333;
  --bar-bg:#1f1f2e;
  --bar-active:var(--accent-orange);
}

body{
  font-family:'Cairo',sans-serif;
  margin:0; padding:0;
  direction:rtl;
  background: var(--bg-gradient);
  overflow-x:hidden;
}

header{
  background: var(--primary-blue);
  color:#fff;
  text-align:center;
  padding:20px;
  font-size:22px;
  font-weight:bold;
  position:relative;
  z-index:10;
}

/* Login Form */
#loginForm{
  max-width:400px;
  margin:40px auto;
  background:var(--card-bg);
  padding:20px;
  border-radius:12px;
  box-shadow:0 10px 25px rgba(0,0,0,0.15);
  display:grid;
  gap:12px;
}

#loginForm input{
  padding:10px;
  font-size:15px;
  border-radius:8px;
  border:1px solid #ccc;
  width:100%;
}

#loginForm button{
  padding:12px;
  border-radius:8px;
  border:none;
  cursor:pointer;
  font-weight:700;
  background: var(--accent-orange);
  color:#fff;
  font-size:16px;
  transition:0.3s;
}

#loginForm button:hover{
  background: var(--accent-red);
  transform: scale(1.05);
}

#loginForm a{
  text-align:center;
  display:block;
  color:var(--primary-blue);
  text-decoration:underline;
  margin-top:10px;
}

/* Container */
.container{
  max-width:1200px;
  margin:20px auto 80px auto;
  padding:0 15px;
  display:grid;
  grid-template-columns:1fr;
  gap:20px;
  position:relative;
}

/* Sections */
.section{
  background: var(--card-bg);
  border-radius:15px;
  box-shadow:0 10px 25px rgba(0,0,0,0.15);
  padding:15px;
  opacity:0;
  transform:translateY(30px);
  display:none;
}

.section.active{
  display:block;
}

.section h3{
  text-align:center;
  color: var(--primary-blue);
  margin-bottom:10px;
}

table{
  width:100%;
  border-collapse: collapse;
  font-size:13px;
}

th,td{
  border:1px solid #ddd;
  padding:6px 8px;
  text-align:right;
  word-break:break-word;
}

tr:hover{ background-color: rgba(78,84,200,0.1); }

/* Bottom Bar */
.bottom-bar{
  position:fixed;
  bottom:0; left:0; right:0;
  height:60px;
  background: var(--bar-bg);
  display:flex;
  justify-content:space-around;
  align-items:center;
  z-index:20;
  box-shadow:0 -4px 15px rgba(0,0,0,0.3);
}

.bottom-bar button{
  background:transparent;
  border:none;
  color:#fff;
  font-size:16px;
  cursor:pointer;
  transition:all 0.3s ease;
  position:relative;
}

.bottom-bar button.active::after{
  content:'';
  position:absolute;
  bottom:5px;
  left:50%;
  transform:translateX(-50%);
  width:6px;
  height:6px;
  border-radius:50%;
  background: var(--bar-active);
}

.bottom-bar button:hover{
  color: var(--accent-orange);
  transform: scale(1.1);
}

/* Logout Button */
#logoutBtn{
  background: var(--accent-red);
  color:#fff;
  padding:8px 12px;
  border:none;
  border-radius:8px;
  cursor:pointer;
  font-weight:700;
  float:left;
  margin-bottom:10px;
}

#logoutBtn:hover{
  background: var(--accent-orange);
  transform: scale(1.05);
}
</style>
</head>
<body>

<header>๐ ุซุงูููุฉ ุงูุชุญุฏู - ูุธุงู ุงูุทูุงุจ</header>

<!-- Login Form -->
<div id="loginForm">
  <input id="parentNumber" placeholder="ุฃุฏุฎู ุฑูู ููู ุงูุฃูุฑ">
  <input id="studentCode" placeholder="ุฃุฏุฎู ููุฏ ุงูุทุงูุจ">
  <button id="loginBtn">ุชุณุฌูู ุงูุฏุฎูู</button>
  <a href="forgot.html">ูุณูุช ุงูููุฏุ</a>
</div>

<!-- Container ุจุนุฏ ุชุณุฌูู ุงูุฏุฎูู -->
<div class="container" id="appContainer" style="display:none">

  <button id="logoutBtn">ุชุณุฌูู ุงูุฎุฑูุฌ</button>

  <!-- ุงูุญุณุงุจ -->
  <div class="section active" id="accountSection">
    <h3>ุงูุญุณุงุจ</h3>
    <div id="accountInfo">ุฌุงุฑู ุชุญููู ุงูุจูุงูุงุช...</div>
  </div>

  <!-- ุงูุฏุฑุฌุงุช -->
  <div class="section" id="gradesSection">
    <h3>ุงูุฏุฑุฌุงุช</h3>
    <div id="gradesInfo">ุฌุงุฑู ุชุญููู ุงูุฏุฑุฌุงุช...</div>
  </div>

  <!-- ุงูุชุจููุบุงุช -->
  <div class="section" id="alertsSection">
    <h3>ุงูุชุจููุบุงุช</h3>
    <div id="alertsInfo">ุฌุงุฑู ุชุญููู ุงูุชุจููุบุงุช...</div>
    <div id="newAlertSection" style="margin-top:15px;"></div>
  </div>

  <!-- ุงูุฏุฑุฏุดุฉ -->
  <div class="section" id="chatSection">
    <h3>ุงูุฏุฑุฏุดุฉ</h3>
    <p>ุงูุฏุฑุฏุดุฉ ูุน ุทูุงุจ ุตูู. ูู ุญุงูุฉ ุงูุตูุงูุฉ ูุฑุฌู ุงูุงูุชุธุงุฑ.</p>
  </div>

</div>

<!-- Bottom Bar -->
<div class="bottom-bar" style="display:none">
  <button class="active" data-target="accountSection">ุงูุญุณุงุจ</button>
  <button data-target="gradesSection">ุงูุฏุฑุฌุงุช</button>
  <button data-target="alertsSection">ุงูุชุจููุบุงุช</button>
  <button data-target="chatSection">ุงูุฏุฑุฏุดุฉ</button>
</div>

<script>
// ุฑุงุจุท Google Sheet CSV
const SHEET_URL="https://docs.google.com/spreadsheets/d/e/2PACX-1vReghaYoMk3f8ffSBLRHIwZieEWCfk5Yx8W6c843TXkC6wpA78Z0X5nw21RRpxMdQ/pub?output=csv";

// CSV Parser
function parseCSV(text){
  const rows=[];
  let cur='',row=[],inQuotes=false;
  for(let i=0;i<text.length;i++){
    const ch=text[i],next=text[i+1];
    if(ch=='"'){
      if(inQuotes&&next=='"'){cur+='"';i++; continue;}
      inQuotes=!inQuotes; continue;
    }
    if(ch=='\r') continue;
    if(ch==','&&!inQuotes){row.push(cur); cur=''; continue;}
    if(ch=='\n'&&!inQuotes){row.push(cur); rows.push(row); row=[]; cur=''; continue;}
    cur+=ch;
  }
  if(cur!=''||row.length>0){row.push(cur); rows.push(row);}
  return rows;
}

function normalizeKey(k){return (k||'').toString().trim();}

// ุฌูุจ ุจูุงูุงุช Google Sheet
async function fetchSheetObjects(){
  const resp=await fetch(SHEET_URL);
  if(!resp.ok) throw new Error("ูุดู ุฌูุจ ุงูุจูุงูุงุช");
  const text=await resp.text();
  const rows=parseCSV(text).filter(r=>r.some(c=>c.trim()!=''));
  if(rows.length===0) return{header:[],rows:[]};
  const header=rows[0].map(h=>normalizeKey(h));
  const dataRows=rows.slice(1);
  const objects=dataRows.map(r=>{
    const obj={};
    for(let i=0;i<header.length;i++){
      obj[header[i]]=(r[i]||'').toString().trim();
    }
    return obj;
  });
  return{header,rows:objects};
}

document.addEventListener('DOMContentLoaded',()=>{

  const loginForm=document.getElementById('loginForm');
  const loginBtn=document.getElementById('loginBtn');
  const appContainer=document.getElementById('appContainer');
  const bottomBar=document.querySelector('.bottom-bar');
  const sections=document.querySelectorAll('.section');
  const barButtons=document.querySelectorAll('.bottom-bar button');
  const logoutBtn=document.getElementById('logoutBtn');

  let userData=null;

  // ุชุณุฌูู ุงูุฏุฎูู
  loginBtn.addEventListener('click',async()=>{
    const parent=document.getElementById('parentNumber').value.trim();
    const code=document.getElementById('studentCode').value.trim();
    if(!parent||!code){
      alert('ุงูุฑุฌุงุก ุฅุฏุฎุงู ุฑูู ููู ุงูุฃูุฑ ูููุฏ ุงูุทุงูุจ');
      return;
    }

    try{
      const {rows}=await fetchSheetObjects();
      // ุงูุจุญุซ ุนู ุงูุทุงูุจ
      const found=rows.find(r=>{
        const p=r['ุฑูู ููู ุงูุงูุฑ']||r['ุฑูู ููู ุงูุฃูุฑ']||'';
        const c=r['ููุฏ ุงูุทุงูุจ']||r['id']||'';
        return p===parent && c===code;
      });
      if(!found){alert('ุจูุงูุงุช ุฎุงุทุฆุฉ'); return;}
      userData=found;

      loginForm.style.display='none';
      appContainer.style.display='block';
      bottomBar.style.display='flex';

      loadAccountData();
      loadGradesData();
      loadAlertsData(rows);

      gsap.to(document.querySelector('.section.active'),{opacity:1,y:0,duration:0.6,ease:"power3.out"});
    }catch(err){
      console.error(err);
      alert('ุฎุทุฃ ูู ุฌูุจ ุงูุจูุงูุงุช');
    }
  });

  // ุชุณุฌูู ุงูุฎุฑูุฌ
  logoutBtn.addEventListener('click',()=>{
    appContainer.style.display='none';
    bottomBar.style.display='none';
    loginForm.style.display='grid';
    document.getElementById('parentNumber').value='';
    document.getElementById('studentCode').value='';
  });

  // ุงูุชููู ุจูู ุงูุฃูุณุงู
  barButtons.forEach(btn=>{
    btn.addEventListener('click',()=>{
      const targetId=btn.getAttribute('data-target');
      barButtons.forEach(b=>b.classList.remove('active'));
      btn.classList.add('active');

      sections.forEach(sec=>{
        if(sec.id===targetId){
          sec.classList.add('active');
          gsap.fromTo(sec,{opacity:0,y:30},{opacity:1,y:0,duration:0.5,ease:"power3.out"});
        } else{
          sec.classList.remove('active');
          gsap.to(sec,{opacity:0,y:30,duration:0.3,ease:"power3.out"});
        }
      });
    });
  });

  // ุชุญููู ุงูุญุณุงุจ
  function loadAccountData(){
    const infoDiv=document.getElementById('accountInfo');
    let html='<table>';
    const generalFields=['id','ุงุณู ุงูุทุงูุจ','ุงูุตู','ุงููุงุนุฉ','ุงูุฌูุณ','ุฑูู ููู ุงูุงูุฑ','ุฑูู ุงูุฎุท','ุงูููุงุญุธุงุช','ููุฏ ุงูุทุงูุจ','ุฑูู ุงูุทุงูุจ','ููุงุญุธุงุช ูุฑุช','ููุงุญุธุงุช ุงููุชูุฌุฉ','ุงููุชุจ','ุงูุนููุงู','ุงุณู ุงูุงู','ุงููุฏุฑุณุฉ ุงููุงุฏู ูููุง','ุงููุนุฏู ูู ุงูุตู ุงูุณุงุจู'];
    html+='<tr><th colspan="2">ุงููุนูููุงุช ุงูุนุงูุฉ</th></tr>';
    generalFields.forEach(f=>{
      html+=`<tr><td>${f}</td><td>${userData[f]||''}</td></tr>`;
    });

    const financeFields=['ุงููุณุท 1','ุชุงุฑูุฎ 1','ุงููุณุท 2','ุชุงุฑูุฎ 2','ุงููุณุท 3','ุชุงุฑูุฎ 3','ุงููุณุท 4','ุชุงุฑูุฎ 4','ุงููุณุท 5','ุชุงุฑูุฎ 5','ุงููุณุท 6','ุชุงุฑูุฎ 6','ุงููุณุท 7','ุชุงุฑูุฎ 7','ุงููุณุท 8','ุชุงุฑูุฎ 8','ุงูุจุงูู ุงูููู','ุงููุจูุบ ุงูููู','ุงููุงุตู ุงูููู','ุงูููุงูุฉ','ูุจูุบ ุงูููุงูุฉ'];
    html+='<tr><th colspan="2">ุงููุนูููุงุช ุงููุงููุฉ</th></tr>';
    financeFields.forEach(f=>{
      html+=`<tr><td>${f}</td><td>${userData[f]||''}</td></tr>`;
    });

    html+='</table>';
    infoDiv.innerHTML=html;
  }

  // ุชุญููู ุงูุฏุฑุฌุงุช
  function loadGradesData(){
    const gradesDiv=document.getElementById('gradesInfo');
    const gradeFields=['ุงุณูุงููุฉ ุดูุฑ 1','ุงุณูุงููุฉ ุดูุฑ 2','ุงุณูุงููุฉ ูุตู 1','ูุงุณูุงููุฉ ุตู ุณูุฉ','ุงุณูุงููุฉ ุดูุฑ 3','ุงุณูุงููุฉ ุดูุฑ 4','ุงุณูุงููุฉ ูุตู 2','ุงุณูุงููุฉ ุงูุงูุชุญุงู ุงูููุงุฆู','ุงุณูุงููุฉ ุงูุณุนู','ุงุณูุงููุฉ ุงูุชูุฏูุฑ','ุงูุนุฑุจู ุดูุฑ 1','ุงูุนุฑุจู ุดูุฑ 2','ุงูุนุฑุจู ูุตู 1','ุงูุนุฑุจู ูุตู ุณูุฉ','ุงูุนุฑุจู ุดูุฑ 3','ุงูุนุฑุจู ุดูุฑ 4','ุงูุนุฑุจู ูุตู 2','ุงูุนุฑุจู ุงูุงูุชุญุงู ุงูููุงุฆู','ุงูุนุฑุจู ุงูุณุนู','ุงูุนุฑุจู ุงูุชูุฏูุฑ','ุงูุงููููุฒู ุดูุฑ 1','ุงูุงููููุฒู ุดูุฑ 2','ุงูุงููููุฒู ูุตู 1','ุงูุงููููุฒู ูุตู ุณูุฉ','ุงูุงููููุฒู ุดูุฑ 3','ุงูุงููููุฒู ุดูุฑ 4','ุงูุงููููุฒู ูุตู 2','ุงูุงููููุฒู ุงูุงูุชุญุงู ุงูููุงุฆู','ุงูุงููููุฒู ุงูุณุนู','ุงูุงููููุฒู ุงูุชูุฏูุฑ','ุงูุฑูุงุถูุงุช ุดูุฑ 1','ุงูุฑูุงุถูุงุช ุดูุฑ 2','ุงูุฑูุงุถูุงุช ูุตู 1','ุงูุฑูุงุถูุงุช ูุตู ุณูุฉ','ุงูุฑูุงุถูุงุช ุดูุฑ 3','ุงูุฑูุงุถูุงุช ุดูุฑ 4','ุงูุฑูุงุถูุงุช ูุตู 2','ุงูุฑูุงุถูุงุช ุงูุงูุชุญุงู ุงูููุงุฆู','ุงูุฑูุงุถูุงุช ุงูุณุนู','ุงูุฑูุงุถูุงุช ุงูุชูุฏูุฑ','ุงูููููุงุก ุดูุฑ 1','ุงูููููุงุก ุดูุฑ 2','ุงูููููุงุก ูุตู 1','ุงูููููุงุก ูุตู ุณูุฉ','ุงูููููุงุก ุดูุฑ 3','ุงูููููุงุก ุดูุฑ 4','ุงูููููุงุก ูุตู 2','ุงูููููุงุก ุงูุงูุชุญุงู ุงูููุงุฆู','ุงูููููุงุก ุงูุณุนู','ุงูููููุงุก ุงูุชูุฏูุฑ','ุงูููุฒูุงุก ุดูุฑ 1','ุงูููุฒูุงุก ุดูุฑ 2','ุงูููุฒูุงุก ูุตู 1','ุงูููุฒูุงุก ูุตู ุณูุฉ','ุงูููุฒูุงุก ุดูุฑ 3','ุงูููุฒูุงุก ุดูุฑ 4','ุงูููุฒูุงุก ูุตู 2','ุงูููุฒูุงุก ุงูุงูุชุญุงู ุงูููุงุฆู','ุงูููุฒูุงุก ุงูุณุนู','ุงูููุฒูุงุก ุงูุชูุฏูุฑ','ุงูุงุญูุงุก ุดูุฑ 1','ุงูุงุญูุงุก ุดูุฑ 2','ุงูุงุญูุงุก ูุตู 1','ุงูุงุญูุงุก ูุตู ุณูุฉ','ุงูุงุญูุงุก ุดูุฑ 3','ุงูุงุญูุงุก ุดูุฑ 4','ุงูุงุญูุงุก ูุตู 2','ุงูุงุญูุงุก ุงูุงูุชุญุงู ุงูููุงุฆู','ุงูุงุญูุงุก ุงูุณุนู','ุงูุงุญูุงุก ุงูุชูุฏูุฑ','ุงูุงุฌุชูุงุนูุงุช ุดูุฑ 1','ุงูุงุฌุชูุงุนูุงุช ุดูุฑ 2','ุงูุงุฌุชูุงุนูุงุช ูุตู 1','ุงูุงุฌุชูุงุนูุงุช ูุตู ุณูุฉ','ุงูุงุฌุชูุงุนูุงุช ุดูุฑ 3','ุงูุงุฌุชูุงุนูุงุช ุดูุฑ 4','ุงูุงุฌุชูุงุนูุงุช ูุตู 2','ุงูุงุฌุชูุงุนูุงุช ุงูุงูุชุญุงู ุงูููุงุฆู','ุงูุงุฌุชูุงุนูุงุช ุงูุณุนู','ุงูุงุฌุชูุงุนูุงุช ุงูุชูุฏูุฑ','ุงูุญุงุณูุจ ุดูุฑ 1','ุงูุญุงุณูุจ ุดูุฑ 2','ุงูุญุงุณูุจ ูุตู 1','ุงูุญุงุณูุจ ูุตู ุณูุฉ','ุงูุญุงุณูุจ ุดูุฑ 3','ุงูุญุงุณูุจ ุดูุฑ 4','ุงูุญุงุณูุจ ูุตู 2','ุงูุญุงุณูุจ ุงูุงูุชุญุงู ุงูููุงุฆู','ุงูุญุงุณูุจ ุงูุณุนู','ุงูุญุงุณูุจ ุงูุชูุฏูุฑ','ุฑูุงุถุฉ ุดูุฑ 1','ุฑูุงุถุฉ ุดูุฑ 2','ุฑูุงุถุฉ ูุตู 1','ุฑูุงุถุฉ ูุตู ุณูุฉ','ุฑูุงุถุฉ ุดูุฑ 3','ุฑูุงุถุฉ ุดูุฑ 4','ุฑูุงุถุฉ ูุตู 2','ุฑูุงุถุฉ ุงูุงูุชุญุงู ุงูููุงุฆู','ุฑูุงุถุฉ ุงูุณุนู','ุฑูุงุถุฉ ุงูุชูุฏูุฑ','ุงููููุฉ ุดูุฑ 1','ุงููููุฉ ุดูุฑ 2','ุงููููุฉ ูุตู 1','ุงููููุฉ ูุตู ุณูุฉ','ุงููููุฉ ุดูุฑ 3','ุงููููุฉ ุดูุฑ 4','ุงููููุฉ ูุตู 2','ุงููููุฉ ุงูุงูุชุญุงู ุงูููุงุฆู','ุงููููุฉ ุงูุณุนู','ุงููููุฉ ุงูุชูุฏูุฑ','ุงูุณููู ุดูุฑ 1','ุงูุณููู ุดูุฑ 2','ุงูุณููู ูุตู 1','ุงูุณููู ูุตู ุณูุฉ','ุงูุณููู ุดูุฑ 3','ุงูุณููู ุดูุฑ 4','ุงูุณููู ูุตู 2','ุงูุณููู ุงูุงูุชุญุงู ุงูููุงุฆู','ุงูุณููู ุงูุณุนู','ุงูุณููู ุงูุชูุฏูุฑ','ููุงุญุธุงุช ูุฑุช'];

    let html='<table><tr><th>ุงููุงุฏุฉ/ุงูุชูููู</th><th>ุงูุฏุฑุฌุฉ</th></tr>';
    gradeFields.forEach(f=>{
      html+=`<tr><td>${f}</td><td>${userData[f]||''}</td></tr>`;
    });
    html+='</table>';
    gradesDiv.innerHTML=html;
  }

  // ุงูุชุจููุบุงุช
  function loadAlertsData(allRows){
    const alertsDiv=document.getElementById('alertsInfo');
    const newAlertDiv=document.getElementById('newAlertSection');
    let html='';

    // ุนุฑุถ ุงูุชุจููุบุงุช ููุทูุงุจ
    const alertsFields=['ุชุจููุบ 1','ุชุจููุบ 2','ุชุจููุบ 3','ุชุจููุบ 4','ุชุจููุบ 5'];
    alertsFields.forEach(f=>{
      if(userData[f] && userData[f].trim()!==''){
        html+=`<p>๐ ${userData[f]}</p>`;
      }
    });
    alertsDiv.innerHTML=html || '<p>ูุง ุชูุฌุฏ ุชุจููุบุงุช</p>';

    // ุฅุฐุง ุงูุตู ุฅุฏุงุฑุฉ ููููู ุฅุถุงูุฉ ุชุจููุบ
    if(userData['ุงูุตู'] && userData['ุงูุตู'].toLowerCase()==='ุงูุงุฏุงุฑุฉ'){
      newAlertDiv.innerHTML=`<input type="text" id="newAlertInput" placeholder="ุงูุชุจ ุชุจููุบ ุฌุฏูุฏ" style="width:70%;padding:6px;border-radius:6px;border:1px solid #ccc">
      <button id="sendAlertBtn" style="padding:6px 12px;margin-left:8px;border:none;border-radius:6px;background:var(--accent-orange);color:#fff;cursor:pointer;font-weight:700;">ูุดุฑ</button>`;

      document.getElementById('sendAlertBtn').addEventListener('click',()=>{
        const val=document.getElementById('newAlertInput').value.trim();
        if(!val){alert('ุฃุฏุฎู ุงูุชุจููุบ'); return;}
        // ููุง ููููู ุฅุถุงูุฉ ููุฏ ูุฅุฑุณุงู ุงูุชุจููุบ ููู ุงูุทูุงุจ ุนุจุฑ Google Sheet API ุฃู Apps Script
        alert('ุชู ูุดุฑ ุงูุชุจููุบ: '+val);
        document.getElementById('newAlertInput').value='';
      });
    }else{
      newAlertDiv.innerHTML='';
    }
  }

});
</script>

</body>
</html>
