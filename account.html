<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø§Ù„Ø­Ø³Ø§Ø¨ - Ø«Ø§Ù†ÙˆÙŠØ© Ø§Ù„ØªØ­Ø¯ÙŠ</title>
<link rel="stylesheet" href="style.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
<style>
/* ØªØµÙ…ÙŠÙ… Ø¹Ø§Ù… */
body { font-family: 'Cairo', sans-serif; direction: rtl; margin:0; background: linear-gradient(180deg,#f7fbff,#ffffff);}
.app { max-width: 980px; margin:24px auto 110px; padding:18px;}
.app-header { text-align:center; margin-bottom:14px;}
.app-header h1{margin:0; background:linear-gradient(90deg,#4f46e5,#0ea5e9); -webkit-background-clip:text; color:transparent; font-weight:800;}
.app-header p { margin:8px 0 0 0; color:#6b7280; font-size:13px;}
.card{background:#fff; border-radius:14px; padding:18px; box-shadow:0 12px 30px rgba(15,23,42,0.08); margin-bottom:14px; transform: translateY(18px); opacity:0; transition: transform .6s, opacity .6s;}
input[type=text], input[type=number] { width:100%; padding:10px; border-radius:10px; border:1px solid #e6e9ef; margin-bottom:8px; }
input:focus { outline:none; border-color:#4f46e5; box-shadow:0 8px 30px rgba(79,70,229,0.06);}
button { padding:10px 18px; border-radius:10px; border:none; cursor:pointer; font-weight:800; margin-top:8px;}
.btn-primary { background:linear-gradient(90deg,#4f46e5,#0ea5e9); color:#fff; }
.btn-logout { background:#ef4444; color:#fff; }
.section { margin-bottom:20px; }
.section h3 { text-align:center; background:#4f46e5; color:#fff; padding:10px; border-radius:10px; margin-bottom:10px;}
</style>
</head>
<body>
<div class="app">
  <div class="app-header">
    <h1>Ø­Ø³Ø§Ø¨ Ø§Ù„Ø·Ø§Ù„Ø¨</h1>
    <p>Ø¹Ø±Ø¶ ÙˆØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ© ÙˆØ§Ù„Ù…Ø§Ù„ÙŠØ©</p>
  </div>

  <div class="card" id="accountCard">
    <div id="infoSection" class="section">
      <h3>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨</h3>
      <div id="infoFields"></div>
    </div>

    <div id="financeSection" class="section">
      <h3>Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©</h3>
      <div id="financeFields"></div>
    </div>

    <button class="btn btn-primary" id="saveBtn">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¹Ø¯Ù„Ø©</button>
    <button class="btn btn-logout" id="logoutBtn">ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
    <p id="statusMsg" style="text-align:center;margin-top:10px;"></p>
  </div>
</div>

<nav class="bottom-nav">
  <a href="account.html" class="active">ğŸ‘¤<span>Ø§Ù„Ø­Ø³Ø§Ø¨</span></a>
  <a href="grades.html">ğŸ“š<span>Ø§Ù„Ø¯Ø±Ø¬Ø§Øª</span></a>
  <a href="notifications.html">ğŸ””<span>Ø§Ù„ØªØ¨Ù„ÙŠØºØ§Øª</span></a>
  <a href="chat.html">ğŸ’¬<span>Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©</span></a>
</nav>

<script>
const SHEET_API_URL = "YOUR_GOOGLE_SHEET_API_URL"; // Ø¶Ø¹ Ù‡Ù†Ø§ Ø±Ø§Ø¨Ø· Google Apps Script

async function fetchSheetData(){
  const resp = await fetch(SHEET_API_URL, {cache:"no-store"});
  if(!resp.ok) throw new Error("ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Google Sheets");
  const json = await resp.json();
  return json;
}

function getSession(){ return JSON.parse(sessionStorage.getItem('studentData')||'null'); }
function saveSession(obj){ sessionStorage.setItem('studentData', JSON.stringify(obj)); }
function requireLogin(){ if(!getSession()){ window.location.href='index.html'; return false;} return true; }

document.addEventListener('DOMContentLoaded', async ()=>{
  if(!requireLogin()) return;
  gsap.to('#accountCard', {duration:0.7, opacity:1, y:0, ease:'power3.out'});

  const student = getSession();
  const infoFieldsContainer = document.getElementById('infoFields');
  const financeFieldsContainer = document.getElementById('financeFields');

  // Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØ¹Ø¯ÙŠÙ„
  const editableFields = ['Ø±Ù‚Ù… Ø§Ù„Ø·Ø§Ù„Ø¨','Ø±Ù‚Ù… ÙˆÙ„ÙŠ Ø§Ù„Ø§Ù…Ø±','Ø±Ù‚Ù… Ø§Ù„Ø®Ø·','Ø§Ù„Ù…Ø¯Ø±Ø³Ø© Ø§Ù„Ù‚Ø§Ø¯Ù… Ù…Ù†Ù‡Ø§','Ø§Ù„Ø¹Ù†ÙˆØ§Ù†'];

  // Ø¹Ø±Ø¶ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨
  const infoFields = ["id","Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨","Ø§Ù„ØµÙ","Ø§Ù„Ù‚Ø§Ø¹Ø©","Ø§Ù„Ø¬Ù†Ø³","Ø±Ù‚Ù… ÙˆÙ„ÙŠ Ø§Ù„Ø§Ù…Ø±","Ø±Ù‚Ù… Ø§Ù„Ø®Ø·","Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª","ÙƒÙˆØ¯ Ø§Ù„Ø·Ø§Ù„Ø¨","Ø±Ù‚Ù… Ø§Ù„Ø·Ø§Ù„Ø¨","Ø§Ù„ÙƒØªØ¨","Ø§Ù„Ø¹Ù†ÙˆØ§Ù†","Ø§Ø³Ù… Ø§Ù„Ø§Ù…","Ø§Ù„Ù…Ø¯Ø±Ø³Ø© Ø§Ù„Ù‚Ø§Ø¯Ù… Ù…Ù†Ù‡Ø§","Ø§Ù„Ù…Ø¹Ø¯Ù„"];
  infoFields.forEach(f=>{
    const val = student[f]||'';
    if(editableFields.includes(f)){
      infoFieldsContainer.innerHTML += `<label>${f}:<input type="text" id="${f}" value="${val}"/></label>`;
    } else {
      infoFieldsContainer.innerHTML += `<p><strong>${f}:</strong> ${val}</p>`;
    }
  });

  // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©
  const financeFields = ["Ø§Ù„Ù‚Ø³Ø· 1","ØªØ§Ø±ÙŠØ® 1","Ø§Ù„Ù‚Ø³Ø· 2","ØªØ§Ø±ÙŠØ® 2","Ø§Ù„Ù‚Ø³Ø· 3","ØªØ§Ø±ÙŠØ® 3","Ø§Ù„Ù‚Ø³Ø· 4","ØªØ§Ø±ÙŠØ® 4","Ø§Ù„Ù‚Ø³Ø· 5","ØªØ§Ø±ÙŠØ® 5","Ø§Ù„Ù‚Ø³Ø· 6","ØªØ§Ø±ÙŠØ® 6","Ø§Ù„Ù‚Ø³Ø· 7","ØªØ§Ø±ÙŠØ® 7","Ø§Ù„Ù‚Ø³Ø· 8","ØªØ§Ø±ÙŠØ® 8","Ø§Ù„Ø¨Ø§Ù‚ÙŠ Ø§Ù„ÙƒÙ„ÙŠ","Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„ÙƒÙ„ÙŠ","Ø§Ù„ÙˆØ§ØµÙ„ Ø§Ù„ÙƒÙ„ÙŠ","Ø§Ù„ÙƒÙØ§Ù„Ø©","Ù…Ø¨Ù„Øº Ø§Ù„ÙƒÙØ§Ù„Ø©"];
  financeFields.forEach(f=>{
    const val = student[f]||'';
    financeFieldsContainer.innerHTML += `<p><strong>${f}:</strong> ${val}</p>`;
  });

  // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¹Ø¯Ù„Ø©
  document.getElementById('saveBtn').addEventListener('click', async ()=>{
    const updatedData = {...student};
    editableFields.forEach(f=>{ updatedData[f] = document.getElementById(f).value.trim(); });

    // ØªØ­Ø¯ÙŠØ« Google Sheet
    try{
      const resp = await fetch(SHEET_API_URL+"?action=update",{
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body: JSON.stringify(updatedData)
      });
      const result = await resp.json();
      if(result.success){
        saveSession(updatedData);
        document.getElementById('statusMsg').textContent = 'âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­';
      } else {
        document.getElementById('statusMsg').textContent = 'âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª';
      }
    }catch(e){
      console.error(e);
      document.getElementById('statusMsg').textContent = 'âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­ÙØ¸';
    }
  });

  document.getElementById('logoutBtn').addEventListener('click', ()=>{
    sessionStorage.clear();
    window.location.href='index.html';
  });
});
</script>
</body>
</html>
