<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>حساب الطالب</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<header>🎓 ثانوية التحدي الأهلية</header>

<div class="navbar">
  <a href="dashboard.html">🏠 الرئيسية</a>
  <a href="chat.html">💬 الدردشة</a>
  <a href="notifications.html">📢 التبليغات</a>
  <a href="#" onclick="logout()">🚪 تسجيل الخروج</a>
</div>

<div class="container" id="studentData">
  <p style="text-align:center;">جارٍ تحميل البيانات...</p>
</div>

<script>
if(localStorage.getItem("loggedIn") !== "true") window.location.href="index.html";

async function loadStudent(){
  const studentData = JSON.parse(localStorage.getItem("studentData"));
  if(!studentData) {
    document.getElementById("studentData").innerHTML = "<p>❌ لم يتم العثور على بيانات الطالب.</p>";
    return;
  }

  const student = studentData;
  const output = document.getElementById("studentData");
  let html = "";

  html += `<div class="section">
    <h3>🧾 المعلومات العامة</h3>
    <table>
      <tr><th>الاسم الكامل</th><td>${student["اسم الطالب"]}</td></tr>
      <tr><th>الصف</th><td>${student["الصف"]}</td></tr>
      <tr><th>القاعة</th><td>${student["القاعة"]}</td></tr>
      <tr><th>الجنس</th><td>${student["الجنس"]}</td></tr>
      <tr><th>رقم الطالب</th><td><input type="text" id="studentNumber" value="${student["رقم الطالب"] || ""}"></td></tr>
      <tr><th>رقم ولي الأمر</th><td>${student["رقم ولي الامر"] || "غير متوفر"}</td></tr>
      <tr><th>رقم الخط</th><td><input type="text" id="line" value="${student["رقم الخط"]||""}"></td></tr>
      <tr><th>العنوان</th><td><input type="text" id="address" value="${student["العنوان"]||""}"></td></tr>
      <tr><th>المدرسة القادمة منها</th><td><input type="text" id="prevSchool" value="${student["المدرسة السابقة"]||""}"></td></tr>
    </table>
    <div style="text-align:center; margin-top:10px;">
      <button onclick="saveGeneral()">💾 حفظ التعديلات</button>
    </div>
  </div>`;

  // القسم المالي
  html += `<div class="section"><h3>💰 المعلومات المالية</h3><table>
      <tr><th>القسط 1</th><td>${student["القسط 1"]||""}</td></tr>
      <tr><th>تاريخ 1</th><td>${student["تاريخ 1"]||""}</td></tr>
      <tr><th>القسط 2</th><td>${student["القسط 2"]||""}</td></tr>
      <tr><th>تاريخ 2</th><td>${student["تاريخ 2"]||""}</td></tr>
      <tr><th>القسط 3</th><td>${student["القسط 3"]||""}</td></tr>
      <tr><th>تاريخ 3</th><td>${student["تاريخ 3"]||""}</td></tr>
  </table></div>`;

  // الدرجات
  html += `<div class="section"><h3>📘 الدرجات</h3>
  <p>${student["الدرجات"]||"لا توجد بيانات حالياً."}</p></div>`;

  // الملاحظات والغياب
  html += `<div class="section"><h3>📝 الملاحظات والغياب</h3>
  <p>${student["ملاحظات"]||"لا توجد ملاحظات"}</p></div>`;

  output.innerHTML = html;
}

function saveGeneral(){
  const studentData = JSON.parse(localStorage.getItem("studentData"));
  if(!studentData) return alert("حدث خطأ في تحميل البيانات");

  // تحديث الحقول القابلة للتعديل فقط
  studentData["رقم الطالب"] = document.getElementById("studentNumber").value;
  studentData["رقم الخط"] = document.getElementById("line").value;
  studentData["العنوان"] = document.getElementById("address").value;
  studentData["المدرسة السابقة"] = document.getElementById("prevSchool").value;

  localStorage.setItem("studentData", JSON.stringify(studentData));
  alert("✅ تم حفظ التعديلات بنجاح");
}

function logout(){
  localStorage.clear();
  window.location.href = "index.html";
}

loadStudent();
</script>

</body>
</html>
