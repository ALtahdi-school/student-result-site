<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>الدردشة</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<header>🎓 ثانوية التحدي الأهلية</header>

<div class="navbar">
  <a href="dashboard.html">🏠 الرئيسية</a>
  <a href="chat.html">💬 الدردشة</a>
  <a href="notifications.html">📢 التبليغات</a>
  <a href="#" onclick="logout()">🚪 تسجيل الخروج</a>
</div>

<div class="chat-box">
  <div class="messages" id="messages"></div>
  <div class="input-row">
    <input type="text" id="msgInput" placeholder="اكتب رسالتك...">
    <button onclick="sendMsg()">إرسال</button>
  </div>
</div>

<script>
if(localStorage.getItem("loggedIn") !== "true") window.location.href="index.html";

const messagesDiv = document.getElementById("messages");
const studentCode = localStorage.getItem("studentCode");
const studentName = localStorage.getItem("studentName") || studentCode;
const studentClass = localStorage.getItem("studentClass");

let messages = JSON.parse(localStorage.getItem("chatMessages") || "[]");

function displayMessages(){
  messagesDiv.innerHTML = "";
  messages.filter(m => m.class === studentClass).forEach(m=>{
    messagesDiv.innerHTML += `<p><strong>${m.user}:</strong> ${m.text}</p>`;
  });
  messagesDiv.scrollTop = messagesDiv.scrollHeight;
}

function sendMsg(){
  const input = document.getElementById("msgInput");
  if(!input.value) return;
  messages.push({user: studentName, text: input.value, class: studentClass});
  localStorage.setItem("chatMessages", JSON.stringify(messages));
  input.value = "";
  displayMessages();
}

displayMessages();

function logout(){ localStorage.clear(); window.location.href="index.html"; }
</script>

</body>
</html>
